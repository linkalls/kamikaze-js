var f=Object.defineProperty;var o=(h,t)=>f(h,"name",{value:t,configurable:!0});var c=class{static{o(this,"VNode")}constructor(t,e,s){this.tag=t,this.props=e,this.children=s}},p=class h{static{o(this,"Nova")}constructor(t){this.element=t instanceof Element?t:document.createElement(t),this.data={},this.proxyData=null,this.templateNodes=new Map,this.virtualDOM=null}static select(t){let e=document.querySelector(t);return e?new h(e):null}static selectAll(t){return Array.from(document.querySelectorAll(t)).map(e=>new h(e))}bindData(t){return this.data=t,this.proxyData=new Proxy(this.data,{set:o((e,s,n)=>(e[s]=n,this.updateInterpolation(),!0),"set")}),this.saveTemplates(this.element),this.updateInterpolation(),this}saveTemplates(t){let e=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1),s;for(;s=e.nextNode();)s.textContent.includes("{{")&&this.templateNodes.set(s,s.textContent)}updateInterpolation(){this.templateNodes.forEach((t,e)=>{if(e.parentNode){let s=t;Object.keys(this.data).forEach(n=>{let i=new RegExp(`{{${n}}}`,"g");s=s.replace(i,this.data[n])}),e.textContent!==s&&(e.textContent=s)}else this.templateNodes.delete(e)}),this.updateAllBindings()}updateAllBindings(){this.element.querySelectorAll("[data-bind]").forEach(e=>{e.getAttribute("data-bind").split(",").forEach(n=>{let[i,l]=n.split(":").map(r=>r.trim());if(i in this.proxyData){let r=l||"value";if(e.tagName==="INPUT"||e.tagName==="TEXTAREA")r==="value"&&(document.activeElement!==e&&(e.value=this.proxyData[i]),e._novaListenerAdded||(e.addEventListener("input",a=>{this.proxyData[i]=a.target.value}),e._novaListenerAdded=!0));else{let a=e.firstChild;if(a&&a.nodeType===Node.TEXT_NODE){this.templateNodes.has(a)||this.templateNodes.set(a,a.textContent);let m=this.templateNodes.get(a).replace(`{{${i}}}`,this.proxyData[i]);a.textContent!==m&&(a.textContent=m)}}}})})}setStyle(t,e){return this.element.style[t]=e,this}addClass(t){return this.element.classList.add(t),this}removeClass(t){return this.element.classList.remove(t),this}toggleClass(t){return this.element.classList.toggle(t),this}on(t,e){return this.element.addEventListener(t,e),this}onDelegated(t,e,s){return this.element.addEventListener(t,function(n){let i=n.target.closest(e);i&&this.element.contains(i)&&s.call(i,n)}.bind(this)),this}in(t){if(t instanceof h)this.element.appendChild(t.element);else if(t instanceof Node)this.element.appendChild(t);else if(typeof t=="string"){let e=document.createElement("div");for(e.innerHTML=t;e.firstChild;)this.element.appendChild(e.firstChild)}return this.saveTemplates(this.element),this.updateInterpolation(),this}innerHTML(t){return this.element.innerHTML=t,this.saveTemplates(this.element),this.updateInterpolation(),this}innerText(t){return this.element.innerText=t,this.saveTemplates(this.element),this.updateInterpolation(),this}remove(){return this.element.remove(),this}scrollTo(t=400){let e=window.pageYOffset,s=this.element.getBoundingClientRect().top+e,n="now"in window.performance?performance.now():new Date().getTime(),i=o(l=>{let r=l-n,a=Math.min(r/t,1);window.scrollTo(0,e+(s-e)*a),a<1&&requestAnimationFrame(i)},"scroll");return requestAnimationFrame(i),this}insertBefore(t){return t instanceof h?this.element.parentNode.insertBefore(t.element,this.element):t instanceof Node&&this.element.parentNode.insertBefore(t,this.element),this}insertAfter(t){return t instanceof h?this.element.parentNode.insertBefore(t.element,this.element.nextSibling):t instanceof Node&&this.element.parentNode.insertBefore(t,this.element.nextSibling),this}getAttribute(t){return this.element.getAttribute(t)}setAttribute(t,e){return this.element.setAttribute(t,e),this}removeAttribute(t){return this.element.removeAttribute(t),this}createElement(t,e={},...s){return new c(t,e,s)}render(t,e){let s=this.createRealNode(t);e.appendChild(s)}createRealNode(t){if(typeof t=="string")return document.createTextNode(t);let{tag:e,props:s,children:n}=t,i=document.createElement(e);for(let[l,r]of Object.entries(s))i.setAttribute(l,r);return n.forEach(l=>{i.appendChild(this.createRealNode(l))}),i}diff(t,e){if(!t)return e;if(!e)return null;if(typeof t!=typeof e||typeof t=="string"&&t!==e||t.tag!==e.tag)return e;let s={},n={...t.props,...e.props};for(let r in n)t.props[r]!==e.props[r]&&(s[r]=e.props[r]);let i=[],l=Math.max(t.children.length,e.children.length);for(let r=0;r<l;r++)i.push(this.diff(t.children[r],e.children[r]));return new c(e.tag,s,i)}patch(t,e,s,n=0){if(!e)t.appendChild(this.createRealNode(s));else if(!s)t.removeChild(t.childNodes[n]);else if(this.isChanged(e,s))t.replaceChild(this.createRealNode(s),t.childNodes[n]);else if(s.tag){let i=e.children,l=s.children,r=Math.max(i.length,l.length);for(let a=0;a<r;a++)this.patch(t.childNodes[n],i[a],l[a],a)}}isChanged(t,e){return typeof t!=typeof e||typeof t=="string"&&t!==e||t.tag!==e.tag}},g=p;export{g as default};
